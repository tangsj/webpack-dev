#!/usr/bin/env node

/**
 * 命令使用方式
 * wdev init pc [path]
 * wdev init mobile [path]
 */

const ora = require('ora');
const download = require('download-git-repo');

const branch = {
  pc: 'master',
  mobile: 'mobile',
  mapp: 'mapp',
}

const type = process.argv[2];
const platform = process.argv[3];
const path = process.argv[4] || '.';

const exec = require('child_process').exec;

if (['init'].indexOf(type) == -1) {
  console.log('wdev init [options]');
  return;
}

if (!branch[platform]) {
  console.log('模板名称错误，请指定[pc | mobile | mapp]');
  console.log('pc: pc多页面模板');
  console.log('mobile: 手机多页面模板');
  console.log('mapp: 手机单页面模板');
  return;
}

// 指定项目下载保存目录
if (!path) {
  console.log('Error: 请指定项目保存目录。');
  return;
}

const spinner = ora(`Start: 开始下载模板${platform}`);
spinner.start();

download(`https://github.com:tangsj/webpack3-multipage-template#${branch[platform]}`, path, function (err) {
  if (err) {
    spinner.fail('End: 下载失败！');
    spinner.fail(JSON.stringify(err));
    return;
  }

  spinner.succeed('End: 下载成功');
  spinner.color = 'green';
  
  console.log(`Tip: 请执行 cd ${path} -  npm install - npm run dev 启动项目！`);
})
